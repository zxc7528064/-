#!/usr/bin/env python3
# _*_ coding:utf-8 _*_
# Author : Noth
# Time : 2023-8-9
# fofa : app="TDXK-通达OA" && country="CN"

import os
import sys
import re
from tqdm import tqdm
import requests
from bs4 import BeautifulSoup
from threading import *
import threading

# 定義並發線程數

MAX_THREADS = 64

# 創建信號量來限制並發線程數

pool = threading.Semaphore(64)

# 檢查 URL 的函數

def check_url(url):
    try:
        response = requests.get(url, timeout=4)
        response.raise_for_status() # 顯示出錯誤資訊
        with pool:
            url_200.append(url)
    except requests.exceptions.RequestException as err:
        pass

# 存放狀態碼 200 url

url_200 = []

# 判斷 url 狀態碼是否 200 

try:
    with open('C:\\Users\\user\\Desktop\\RedTeam\\X-Fofa\\tdxk.txt','r') as file:
        total_lines = sum(1 for line in file) # 進度條
        file.seek(0)
        for url in tqdm(file, total=total_lines, desc="Checking URLs"):
            url = url.strip()
            check_url(url)
except FileNotFoundError:
    print("目標 target.txt 找不到")
except Exception as e:
    print(e)

if url_200:
    with open('C:\\Users\\user\\Desktop\\RedTeam\\X-Fofa\\tdxk_sucess_200.txt','w') as f:
        for result in url_200:
            f.write(result + '\n')
